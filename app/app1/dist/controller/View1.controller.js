sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("app1.controller.View1",{onInit:function(){this._loadPdfMake();var e=new sap.ui.model.json.JSONModel;var t={chartData:[{month:"Jan",products:120,sales:5e3},{month:"Feb",products:150,sales:7e3},{month:"Mar",products:180,sales:8500},{month:"Apr",products:200,sales:9e3},{month:"May",products:170,sales:8e3},{month:"Jun",products:190,sales:8800}]};e.setData(t);this.getView().setModel(e,"chartModel");var a=this.getView().byId("salesChart");if(!a){console.error("VizFrame not found. Check XML view ID.");return}a.attachEventOnce("renderComplete",function(){a.setVizProperties({plotArea:{colorPalette:["#3D8D7A","#B3D8A8"],dataLabel:{visible:true},animation:{dataLoading:true,dataUpdating:true}},legend:{visible:false},title:{text:"Monthly Sales & Products Sold",visible:true}})})},onAfterRendering:function(){var e=this.getView().byId("_IDGenList").getItems();e[0].addStyleClass("redGlow");e[1].addStyleClass("yellowGlow");e[2].addStyleClass("greenGlow")},onNavToProducts:function(){debugger;var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Products");debugger},onNavToSales:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("Sales")},onGenerateInvoice:async function(){debugger;var e=this.getOwnerComponent().getModel();try{var t=e.bindContext("/Sales");var a=await t.requestObject();if(!a||!a.value||a.value.length===0){sap.m.MessageToast.show("No sales data available.");return}console.log("‚úÖ Sales Data:",a.value);this._showSalesSelectionPopup(a.value)}catch(e){console.error("‚ùå Error fetching sales data:",e);sap.m.MessageToast.show("Failed to fetch sales data.")}},_showSalesSelectionPopup:function(e){var t=this;if(!this.oSalesDialog){this.oSalesDialog=new sap.m.Dialog({title:"Select Sales for Invoice",contentWidth:"500px",contentHeight:"400px",resizable:true,draggable:true,content:[new sap.m.List({id:"salesList",mode:"MultiSelect",items:{path:"/Sales",template:new sap.m.StandardListItem({title:"{ID}",description:"{totalPrice} USD - {paymentMethod}",selected:"{isSelected}"})}})],beginButton:new sap.m.Button({text:"Generate Invoice",type:"Emphasized",press:function(){t._processSelectedSales();t.oSalesDialog.close()}}),endButton:new sap.m.Button({text:"Cancel",press:function(){t.oSalesDialog.close()}})});this.getView().addDependent(this.oSalesDialog)}var a=new sap.ui.model.json.JSONModel({Sales:e});this.oSalesDialog.setModel(a);this.oSalesDialog.open()},_processSelectedSales:async function(){var e=this.oSalesDialog.getModel();var t=e.getProperty("/Sales").filter(e=>e.isSelected);if(!t.length){sap.m.MessageToast.show("Please select at least one sale.");return}var a=this.getOwnerComponent().getModel();for(let e of t){var o=a.bindContext("/generateInvoice(...)");o.setParameter("sale",e.ID);try{await o.execute();var n=await o.getBoundContext().requestObject();console.log(`‚úÖ Invoice Data for Sale ID ${e.ID}:`,n);this.showInvoicePopup(n)}catch(t){console.error(`‚ùå Error generating invoice for Sale ID ${e.ID}:`,t);sap.m.MessageToast.show(`Failed to generate invoice for Sale ID ${e.ID}.`)}}},showInvoicePopup:function(e){var t=parseFloat(e.unitPrice)||0;var a=parseFloat(e.totalPrice)||0;var o=`\n                <div style="font-family: Arial, sans-serif; padding: 10px; max-width: 400px;">\n                    <h2 style="color: #007aff; text-align: center;">üßæ Invoice #${e.invoiceNumber}</h2>\n                    <hr style="border: 1px solid #ddd;">\n                    <table style="width: 100%; border-collapse: collapse;">\n                        <tr><td><b>Sale Date:</b></td><td>${e.saleDate}</td></tr>\n                        <tr><td><b>Customer:</b></td><td>${e.customerName} (${e.customerEmail})</td></tr>\n                        <tr><td><b>Product:</b></td><td>${e.productName}</td></tr>\n                        <tr><td><b>Quantity:</b></td><td>${e.quantity}</td></tr>\n                        <tr><td><b>Unit Price:</b></td><td>$${t.toFixed(2)}</td></tr>\n                        <tr style="background: #f5f5f5;">\n                            <td><b>Total Price:</b></td>\n                            <td style="font-weight: bold; color: #d9534f;">$${a.toFixed(2)}</td>\n                        </tr>\n                        <tr><td><b>Payment Method:</b></td><td>${e.paymentMethod}</td></tr>\n                        <tr><td><b>Status:</b></td><td>${e.status}</td></tr>\n                    </table>\n                    <hr style="border: 1px solid #ddd;">\n                </div>\n            `;var n=new sap.m.Dialog({title:"Invoice Details",icon:"sap-icon://document-text",contentWidth:"450px",type:sap.m.DialogType.Message,content:new sap.ui.core.HTML({content:o}),buttons:[new sap.m.Button({text:"Preview PDF",type:"Emphasized",press:()=>{this.previewInvoicePDF(e)}}),new sap.m.Button({text:"Download PDF",type:"Accept",press:()=>{this.downloadInvoicePDF(e);n.close()}}),new sap.m.Button({text:"Close",type:"Reject",press:function(){n.close()}})]});n.open()},previewInvoicePDF:function(e){if(!pdfMake){sap.m.MessageToast.show("PDF library (pdfMake) not loaded!");return}let t=Number(e.unitPrice)||0;let a=Number(e.totalPrice)||0;var o={content:[{text:"üßæ Invoice Preview",style:"header",alignment:"center",margin:[0,10,0,10]},{text:`Invoice Number: ${e.invoiceNumber}`,style:"subheader"},{text:`Sale Date: ${e.saleDate}`,style:"details"},{text:"\nCustomer Details",style:"sectionHeader"},{table:{widths:["50%","50%"],body:[["Name",e.customerName],["Email",e.customerEmail],["Phone",e.customerPhone||"N/A"]]},layout:"lightHorizontalLines",margin:[0,5,0,15]},{text:"Product Details",style:"sectionHeader"},{table:{widths:["40%","20%","20%","20%"],body:[["Product","Quantity","Unit Price","Total"],[e.productName,e.quantity,`$${t.toFixed(2)}`,{text:`$${a.toFixed(2)}`,bold:true,color:"#d9534f"}]]},layout:"headerLineOnly",margin:[0,5,0,15]},{text:"Payment Details",style:"sectionHeader"},{text:`Payment Method: ${e.paymentMethod}`,style:"details"},{text:`Status: ${e.status}`,style:"details"},{text:"\nThis is a preview. Click 'Download PDF' to save it.",style:"footer",alignment:"center"}],styles:{header:{fontSize:18,bold:true},subheader:{fontSize:14,bold:true},sectionHeader:{fontSize:12,bold:true,color:"#007aff",margin:[0,10,0,5]},details:{fontSize:10,margin:[0,2,0,2]},footer:{fontSize:10,italics:true,margin:[0,20,0,0]}}};var n=new sap.m.Dialog({title:"Invoice Preview",contentWidth:"700px",contentHeight:"80%",resizable:true,draggable:true,content:new sap.ui.core.HTML({content:`\n                        <div style="height: 100%; display: flex; flex-direction: column;">\n                            <iframe id="pdfPreview" style="flex-grow: 1; width: 100%; height: 600px; border: none;"></iframe>\n                        </div>\n                    `}),buttons:[new sap.m.Button({text:"Close",type:"Reject",press:function(){n.close()}})],afterOpen:function(){pdfMake.createPdf(o).getDataUrl(function(e){document.getElementById("pdfPreview").src=e})}});n.open()},downloadInvoicePDF:function(e){if(!pdfMake){sap.m.MessageToast.show("PDF library (pdfMake) not loaded!");return}let t=Number(e.unitPrice)||0;let a=Number(e.totalPrice)||0;var o={content:[{text:"üßæ Invoice",style:"header",alignment:"center",margin:[0,10,0,10]},{text:`Invoice Number: ${e.invoiceNumber}`,style:"subheader"},{text:`Sale Date: ${e.saleDate}`,style:"details"},{text:"\nCustomer Details",style:"sectionHeader"},{table:{widths:["50%","50%"],body:[["Name",e.customerName],["Email",e.customerEmail],["Phone",e.customerPhone||"N/A"]]},layout:"lightHorizontalLines",margin:[0,5,0,15]},{text:"Product Details",style:"sectionHeader"},{table:{widths:["40%","20%","20%","20%"],body:[["Product","Quantity","Unit Price","Total"],[e.productName,e.quantity,`$${t.toFixed(2)}`,{text:`$${a.toFixed(2)}`,bold:true,color:"#d9534f"}]]},layout:"headerLineOnly",margin:[0,5,0,15]},{text:"Payment Details",style:"sectionHeader"},{text:`Payment Method: ${e.paymentMethod}`,style:"details"},{text:`Status: ${e.status}`,style:"details"},{text:"\nThank you for your business!",style:"footer",alignment:"center"}],styles:{header:{fontSize:18,bold:true},subheader:{fontSize:14,bold:true},sectionHeader:{fontSize:12,bold:true,color:"#007aff",margin:[0,10,0,5]},details:{fontSize:10,margin:[0,2,0,2]},footer:{fontSize:10,italics:true,margin:[0,20,0,0]}}};pdfMake.createPdf(o).download(`Invoice_${e.invoiceNumber}.pdf`)},_loadPdfMake:function(){if(typeof pdfMake==="undefined"){jQuery.sap.includeScript("https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js","pdfMakeLib");jQuery.sap.includeScript("https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js","pdfMakeFonts")}}})});
//# sourceMappingURL=View1.controller.js.map